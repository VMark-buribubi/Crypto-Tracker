<div class="container">
  <div class="header-row">
    <h2>Crypto Market</h2>

    <div class="filters">
      <mat-form-field appearance="outline" class="search-field" subscriptSizing="dynamic">
        <mat-label>Search coin</mat-label>
        <input matInput (input)="updateSearch($event)" placeholder="Ex. Bitcoin" />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="trend-field" subscriptSizing="dynamic">
        <mat-label>24h Trend</mat-label>
        <mat-select [value]="trendFilter()" (selectionChange)="updateTrend($event.value)">
          <mat-option value="all">All Trends</mat-option>
          <mat-option value="positive">ðŸ“ˆ Positive Only</mat-option>
          <mat-option value="negative">ðŸ“‰ Negative Only</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="toggle-container">
        <mat-slide-toggle
          color="primary"
          [checked]="showFavoritesOnly()"
          (change)="showFavoritesOnly.set($event.checked)"
        >
          Show Favorites Only
        </mat-slide-toggle>
      </div>
    </div>
  </div>

  <table
    mat-table
    [dataSource]="paginatedCoins()"
    class="mat-elevation-z8"
    matSort
    (matSortChange)="sortData($event)"
  >
    <ng-container matColumnDef="fav">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let coin">
        <button mat-icon-button (click)="toggleFav($event, coin.id)">
          <mat-icon [style.color]="favoritesService.isFavorite(coin.id) ? 'gold' : 'grey'">
            {{ favoritesService.isFavorite(coin.id) ? 'star' : 'star_border' }}
          </mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="image">
      <th mat-header-cell *matHeaderCellDef>Coin</th>
      <td mat-cell *matCellDef="let coin">
        <img
          [src]="coin.image"
          alt="logo"
          width="30"
          style="margin-right: 10px; vertical-align: middle"
        />
      </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
      <td mat-cell *matCellDef="let coin" style="font-weight: bold">
        {{ coin.name }}
        <span style="color: gray; font-weight: normal">({{ coin.symbol | uppercase }})</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="current_price">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Price</th>
      <td mat-cell *matCellDef="let coin">
        {{ coin.current_price | currency: 'USD' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="price_change_percentage_24h">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>24h Change</th>
      <td
        mat-cell
        *matCellDef="let coin"
        [class.text-green]="coin.price_change_percentage_24h > 0"
        [class.text-red]="coin.price_change_percentage_24h < 0"
      >
        {{ coin.price_change_percentage_24h | number: '1.2-2' }}%
      </td>
    </ng-container>

    <ng-container matColumnDef="market_cap">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Market Cap</th>
      <td mat-cell *matCellDef="let coin">
        {{ coin.market_cap | currency: 'USD' : 'symbol' : '1.0-0' }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      [routerLink]="['/coin', row.id]"
      class="coin-row"
    ></tr>
  </table>

  <mat-paginator
    [length]="filteredCoins().length"
    [pageSize]="pageSize()"
    [pageIndex]="pageIndex()"
    [pageSizeOptions]="[5, 10, 25, 50]"
    (page)="handlePageEvent($event)"
    aria-label="Select page"
  >
  </mat-paginator>

  @if (filteredCoins().length === 0) {
    <div style="text-align: center; padding: 20px; color: gray">
      No coins found matching your filters.
    </div>
  }
</div>
